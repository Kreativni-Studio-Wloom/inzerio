<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Debug - Diagnostika</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status { 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px; 
            border-left: 4px solid;
        }
        .success { 
            background-color: #d4edda; 
            color: #155724; 
            border-left-color: #28a745;
        }
        .error { 
            background-color: #f8d7da; 
            color: #721c24; 
            border-left-color: #dc3545;
        }
        .info { 
            background-color: #d1ecf1; 
            color: #0c5460; 
            border-left-color: #17a2b8;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border-left-color: #ffc107;
        }
        button { 
            padding: 12px 24px; 
            margin: 5px; 
            cursor: pointer; 
            border: none;
            border-radius: 5px;
            font-weight: bold;
        }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-warning { background-color: #ffc107; color: black; }
        .btn-danger { background-color: #dc3545; color: white; }
        pre { 
            background-color: #f8f9fa; 
            padding: 15px; 
            border-radius: 5px; 
            overflow-x: auto;
            border: 1px solid #e9ecef;
            font-size: 12px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #495057;
        }
        .log-entry {
            margin: 5px 0;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebase konfigurace
        const firebaseConfig = {
            apiKey: "AIzaSyA1FEmsY458LLKQLGcUaOVXsYr3Ii55QeQ",
            authDomain: "inzerio-inzerce.firebaseapp.com",
            projectId: "inzerio-inzerce",
            storageBucket: "inzerio-inzerce.firebasestorage.app",
            messagingSenderId: "262039290071",
            appId: "1:262039290071:web:30af0eb1c65cd75e307092",
            measurementId: "G-7VD0ZE08M3"
        };
        
        // Glob√°ln√≠ promƒõnn√©
        let firebaseApp = null;
        let firebaseAuth = null;
        let firebaseDb = null;
        
        // Funkce pro logov√°n√≠
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('log');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }
        
        // Funkce pro zobrazen√≠ v√Ωsledku
        function showResult(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        // Test 1: Inicializace Firebase
        async function testFirebaseInit() {
            log('üîß Test 1: Inicializace Firebase...', 'info');
            
            try {
                firebaseApp = initializeApp(firebaseConfig);
                firebaseAuth = getAuth(firebaseApp);
                firebaseDb = getFirestore(firebaseApp);
                
                log('‚úÖ Firebase √∫spƒõ≈°nƒõ inicializov√°n', 'success');
                log(`App: ${firebaseApp.name}`, 'info');
                log(`Auth: ${firebaseAuth.app.name}`, 'info');
                log(`DB: ${firebaseDb.app.name}`, 'info');
                
                showResult('‚úÖ Firebase √∫spƒõ≈°nƒõ inicializov√°n', 'success');
                return true;
            } catch (error) {
                log(`‚ùå Chyba p≈ôi inicializaci Firebase: ${error.message}`, 'error');
                showResult(`‚ùå Chyba p≈ôi inicializaci Firebase: ${error.message}`, 'error');
                return false;
            }
        }
        
        // Test 2: P≈ôipojen√≠ k datab√°zi
        async function testDatabaseConnection() {
            log('üîß Test 2: P≈ôipojen√≠ k datab√°zi...', 'info');
            
            try {
                const { collection, getDocs } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                
                // Test ƒçten√≠ z kolekce 'services'
                const servicesRef = collection(firebaseDb, 'services');
                log('üìÅ Reference na kolekci services vytvo≈ôena', 'info');
                
                const snapshot = await getDocs(servicesRef);
                log(`üìä Poƒçet dokument≈Ø v kolekci services: ${snapshot.docs.length}`, 'info');
                
                if (snapshot.docs.length === 0) {
                    log('‚ö†Ô∏è Kolekce services je pr√°zdn√°', 'warning');
                    showResult('‚ö†Ô∏è Kolekce services je pr√°zdn√° - mo≈æn√° p≈ô√≠ƒçina probl√©mu', 'warning');
                } else {
                    log('‚úÖ Kolekce services obsahuje data', 'success');
                    showResult(`‚úÖ Kolekce services obsahuje ${snapshot.docs.length} slu≈æeb`, 'success');
                    
                    // Zobrazit prvn√≠ dokument jako p≈ô√≠klad
                    const firstDoc = snapshot.docs[0];
                    log(`üìÑ Prvn√≠ dokument: ${firstDoc.id}`, 'info');
                    log(`üìÑ Data: ${JSON.stringify(firstDoc.data(), null, 2)}`, 'info');
                }
                
                return true;
            } catch (error) {
                log(`‚ùå Chyba p≈ôi p≈ôipojen√≠ k datab√°zi: ${error.message}`, 'error');
                log(`‚ùå Error code: ${error.code}`, 'error');
                showResult(`‚ùå Chyba p≈ôi p≈ôipojen√≠ k datab√°zi: ${error.message}`, 'error');
                return false;
            }
        }
        
        // Test 3: Real-time listener
        async function testRealtimeListener() {
            log('üîß Test 3: Real-time listener...', 'info');
            
            try {
                const { collection, query, orderBy, onSnapshot } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                
                const servicesRef = collection(firebaseDb, 'services');
                const q = query(servicesRef, orderBy('createdAt', 'desc'));
                
                log('üëÇ Nastavuji real-time listener...', 'info');
                
                return new Promise((resolve) => {
                    const unsubscribe = onSnapshot(q, (snapshot) => {
                        log(`üì° Real-time update: ${snapshot.docs.length} slu≈æeb`, 'success');
                        log(`üìä Metadata: fromCache=${snapshot.metadata.fromCache}, hasPendingWrites=${snapshot.metadata.hasPendingWrites}`, 'info');
                        
                        if (snapshot.docs.length === 0) {
                            log('‚ö†Ô∏è Real-time listener: ≈æ√°dn√© slu≈æby', 'warning');
                            showResult('‚ö†Ô∏è Real-time listener funguje, ale ≈æ√°dn√© slu≈æby nenalezeny', 'warning');
                        } else {
                            log('‚úÖ Real-time listener funguje spr√°vnƒõ', 'success');
                            showResult(`‚úÖ Real-time listener funguje - ${snapshot.docs.length} slu≈æeb`, 'success');
                        }
                        
                        unsubscribe();
                        resolve(true);
                    }, (error) => {
                        log(`‚ùå Chyba v real-time listeneru: ${error.message}`, 'error');
                        log(`‚ùå Error code: ${error.code}`, 'error');
                        showResult(`‚ùå Chyba v real-time listeneru: ${error.message}`, 'error');
                        resolve(false);
                    });
                    
                    // Timeout po 10 sekund√°ch
                    setTimeout(() => {
                        log('‚è∞ Timeout real-time listeneru', 'warning');
                        unsubscribe();
                        resolve(false);
                    }, 10000);
                });
                
            } catch (error) {
                log(`‚ùå Chyba p≈ôi nastavov√°n√≠ real-time listeneru: ${error.message}`, 'error');
                showResult(`‚ùå Chyba p≈ôi nastavov√°n√≠ real-time listeneru: ${error.message}`, 'error');
                return false;
            }
        }
        
        // Test 4: P≈ôid√°n√≠ testovac√≠ slu≈æby
        async function testAddService() {
            log('üîß Test 4: P≈ôid√°n√≠ testovac√≠ slu≈æby...', 'info');
            
            try {
                const { collection, addDoc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                
                const servicesRef = collection(firebaseDb, 'services');
                const testService = {
                    title: "Debug Test Service",
                    category: "test",
                    description: "Toto je testovac√≠ slu≈æba pro debug",
                    price: "999 Kƒç",
                    location: "Debug City",
                    userId: "debug-user",
                    userEmail: "debug@test.com",
                    createdAt: new Date(),
                    status: "active"
                };
                
                const docRef = await addDoc(servicesRef, testService);
                log(`‚úÖ Testovac√≠ slu≈æba p≈ôid√°na s ID: ${docRef.id}`, 'success');
                showResult(`‚úÖ Testovac√≠ slu≈æba √∫spƒõ≈°nƒõ p≈ôid√°na (ID: ${docRef.id})`, 'success');
                
                return true;
            } catch (error) {
                log(`‚ùå Chyba p≈ôi p≈ôid√°v√°n√≠ slu≈æby: ${error.message}`, 'error');
                log(`‚ùå Error code: ${error.code}`, 'error');
                showResult(`‚ùå Chyba p≈ôi p≈ôid√°v√°n√≠ slu≈æby: ${error.message}`, 'error');
                return false;
            }
        }
        
        // Test 5: Kontrola pravidel
        async function testRules() {
            log('üîß Test 5: Kontrola pravidel...', 'info');
            
            try {
                const { collection, getDocs } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                
                // Pokus o ƒçten√≠ z kolekce
                const testRef = collection(firebaseDb, 'test-rules');
                await getDocs(testRef);
                
                log('‚úÖ Pravidla umo≈æ≈àuj√≠ ƒçten√≠', 'success');
                
                // Pokus o z√°pis
                const { addDoc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                await addDoc(testRef, { test: true, timestamp: new Date() });
                
                log('‚úÖ Pravidla umo≈æ≈àuj√≠ z√°pis', 'success');
                showResult('‚úÖ Firebase pravidla jsou spr√°vnƒõ nastavena', 'success');
                
                return true;
            } catch (error) {
                log(`‚ùå Chyba s pravidly: ${error.message}`, 'error');
                log(`‚ùå Error code: ${error.code}`, 'error');
                showResult(`‚ùå Probl√©m s Firebase pravidly: ${error.message}`, 'error');
                return false;
            }
        }
        
        // Spu≈°tƒõn√≠ v≈°ech test≈Ø
        async function runAllTests() {
            log('üöÄ Spou≈°t√≠m kompletn√≠ diagnostiku Firebase...', 'info');
            document.getElementById('log').innerHTML = '';
            
            const results = [];
            
            results.push(await testFirebaseInit());
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            results.push(await testDatabaseConnection());
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            results.push(await testRealtimeListener());
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            results.push(await testRules());
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            results.push(await testAddService());
            
            const successCount = results.filter(r => r).length;
            const totalCount = results.length;
            
            log(`üìä V√Ωsledky: ${successCount}/${totalCount} test≈Ø √∫spƒõ≈°n√Ωch`, successCount === totalCount ? 'success' : 'warning');
            
            if (successCount === totalCount) {
                showResult('üéâ V≈°echny testy pro≈°ly √∫spƒõ≈°nƒõ! Firebase by mƒõl fungovat.', 'success');
            } else {
                showResult(`‚ö†Ô∏è ${totalCount - successCount} test≈Ø selhalo. Zkontrolujte logy pro detaily.`, 'warning');
            }
        }
        
        // Export funkc√≠ pro glob√°ln√≠ pou≈æit√≠
        window.testFirebaseInit = testFirebaseInit;
        window.testDatabaseConnection = testDatabaseConnection;
        window.testRealtimeListener = testRealtimeListener;
        window.testAddService = testAddService;
        window.testRules = testRules;
        window.runAllTests = runAllTests;
        
        // Automatick√© spu≈°tƒõn√≠ p≈ôi naƒçten√≠
        window.addEventListener('load', () => {
            setTimeout(() => {
                runAllTests();
            }, 1000);
        });
    </script>
</head>
<body>
    <div class="container">
        <h1>üîç Firebase Debug - Diagnostika</h1>
        <p>Tato str√°nka provede kompletn√≠ diagnostiku Firebase p≈ôipojen√≠ a identifikuje mo≈æn√© probl√©my.</p>
        
        <div id="status"></div>
        
        <div class="test-section">
            <h3>üß™ Testy</h3>
            <button class="btn-primary" onclick="runAllTests()">Spustit v≈°echny testy</button>
            <button class="btn-success" onclick="testFirebaseInit()">Test 1: Inicializace</button>
            <button class="btn-success" onclick="testDatabaseConnection()">Test 2: Datab√°ze</button>
            <button class="btn-success" onclick="testRealtimeListener()">Test 3: Real-time</button>
            <button class="btn-warning" onclick="testRules()">Test 4: Pravidla</button>
            <button class="btn-danger" onclick="testAddService()">Test 5: P≈ôid√°n√≠ slu≈æby</button>
        </div>
        
        <div class="test-section">
            <h3>üìã Log</h3>
            <div id="log" style="max-height: 400px; overflow-y: auto; border: 1px solid #dee2e6; padding: 10px; background: #f8f9fa;"></div>
        </div>
        
        <div class="test-section">
            <h3>üîß Mo≈æn√© probl√©my a ≈ôe≈°en√≠</h3>
            <ul>
                <li><strong>Kolekce services je pr√°zdn√°:</strong> Kliknƒõte na "Test 5: P≈ôid√°n√≠ slu≈æby" pro p≈ôid√°n√≠ testovac√≠ch dat</li>
                <li><strong>Chyba s pravidly:</strong> Zkontrolujte Firebase Console ‚Üí Firestore ‚Üí Rules</li>
                <li><strong>Chyba p≈ôipojen√≠:</strong> Zkontrolujte internetov√© p≈ôipojen√≠ a Firebase konfiguraci</li>
                <li><strong>Real-time listener nefunguje:</strong> Mo≈æn√° probl√©m s opr√°vnƒõn√≠mi nebo s√≠≈•ov√Ωm p≈ôipojen√≠m</li>
            </ul>
        </div>
    </div>
</body>
</html>

